import ipcalc

class Format:
    def __init__(self):
        self.target_list = []
        self.result = []
        self.port = 443

    def ImportTargetFromFile(self, filename):
        with open(filename) as file:
            self.target_list = file.read().splitlines()

    def ImportTargetFromIp(self, ip):
        if not self.target_list:
            self.target_list.append(ip)

    def FormatTarget(self, target):
        ret = []
        # 192.168.1.1 192.168.1.1:80 192.168.1.1/16
        if len(target.split(':')) == 2:
            # 192.168.1.1:80
            ip = target.split(':')[0]
            port = target.split(':')[1]
            ret.append([ip, port])
        elif len(target.split('/')) == 2:
            # 192.168.1.1/16
            ip_list = ipcalc.Network(target)
            for ip in ip_list:
                ret.append([str(ip), self.port])
        else:
            # 192.168.1.1
            ret.append([target, self.port])
        return ret

    def GetTarget(self):
        self.result = []
        for target in self.target_list:
            self.result.extend(self.FormatTarget(target))
        ret = self.result
        return ret

    def __del__(self):
        # print('del class')
        self.target_list = []
        self.result = []
        self.port = 443


if __name__ == "__main__":
    Formata = Format()
    Formata.port=33233
    Formata.ImportTargetFromIp('192.168.1.1')
    a=Formata.GetTarget()
    del Formata

    Formata = Format()
    Formata.port = 33233
    Formata.ImportTargetFromIp('192.168.2.1/29')
    b = Formata.GetTarget()
    del Formata

    Formata = Format()
    Formata.port = 33233
    Formata.ImportTargetFromIp('192.168.3.1:4444')
    c = Formata.GetTarget()
    del Formata

    Formata = Format()
    Formata.port = 33233
    Formata.ImportTargetFromFile('test.txt')
    d = Formata.GetTarget()
    del Formata


    print('a', a, '\nb', b, '\nc', c, '\nd', d)
